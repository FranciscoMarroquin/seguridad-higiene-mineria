<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Puestos – Minería</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style> body{font-family:"Outfit",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;} </style>
</head>

<body class="min-h-screen bg-slate-950 text-white antialiased">
  <div class="fixed inset-0 -z-10 overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-b from-slate-950 via-slate-950 to-slate-900"></div>
    <div class="absolute -top-24 left-1/2 h-72 w-72 -translate-x-1/2 rounded-full bg-cyan-500/12 blur-3xl"></div>
    <div class="absolute top-80 -left-24 h-72 w-72 rounded-full bg-indigo-500/12 blur-3xl"></div>
  </div>

  <header class="sticky top-0 z-50 border-b border-white/10 bg-slate-950/70 backdrop-blur">
    <div class="mx-auto max-w-md px-4 py-3 flex items-center justify-between">
      <div class="leading-tight">
        <p class="font-semibold tracking-tight">Puestos</p>
        <p class="text-xs text-slate-300">Selecciona un puesto para ver actividades</p>
      </div>
      <a href="index.html" class="px-3 py-2 rounded-xl hover:bg-white/5 text-slate-200 text-sm">← Inicio</a>
    </div>
  </header>

  <main class="mx-auto max-w-md px-4 pt-6 pb-10 space-y-4">
    <div class="rounded-3xl border border-white/10 bg-white/5 p-4">
      <label class="text-xs text-slate-300">Buscar</label>
      <input id="buscador" type="text" placeholder="Escribe un puesto..."
        class="mt-2 w-full rounded-2xl bg-slate-900/60 border border-white/10 px-4 py-3 text-white placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-cyan-500/50" />
      <p class="mt-2 text-xs text-slate-400">(Escriba por ejemplo: ventilacion, jumbo o alguna palabra clavee)</p>
    </div>

    <section class="space-y-3">
      <h1 class="text-xl font-extrabold tracking-tight">Puestos de trabajo</h1>
      <div id="lista" class="grid gap-3"></div>
    </section>
  </main>

  <script src="data.js"></script>
  <script>
    // ===========================
    // Render de puestos desde MATRIZ_MINERA
    // ===========================
    const puestosUnicos = Array.from(
      new Map(window.MATRIZ_MINERA.map(x => [x.puestoId, x.puestoNombre])).entries()
    ).map(([puestoId, puestoNombre]) => ({ puestoId, puestoNombre }));

    const lista = document.getElementById("lista");
    const buscador = document.getElementById("buscador");

    function imgPorPuesto(puestoId) {
      // AQUI SE OBTIENE LA IMAGEN AUTOMÁTICA
      return window.IMAGEN_POR_PUESTO?.[puestoId] || "";
    }

    function cardPuesto(p) {
      const img = imgPorPuesto(p.puestoId);

      return `
        <a href="actividades.html?puesto=${encodeURIComponent(p.puestoId)}"
           class="block rounded-3xl border border-white/10 bg-white/5 overflow-hidden hover:bg-white/10 transition active:scale-[0.99]">

          <!-- Imagen del puesto -->
          <div class="h-32 w-full bg-slate-900">
            <!-- AQUI SE CARGA AUTOMÁTICAMENTE LA IMAGEN -->
            ${img
              ? `<img src="${img}" alt="Imagen ${p.puestoNombre}" class="h-32 w-full object-cover" />`
              : `<div class="h-32 w-full grid place-items-center text-xs text-slate-400">
                   <!-- AQUI INSERTA EL URL SI QUIERES UNA IMAGEN -->
                   Sin imagen (revisa IMAGEN_POR_PUESTO)
                 </div>`}
          </div>

          <div class="p-5">
            <div class="flex items-start justify-between gap-4">
              <div>
                <p class="text-lg font-bold">${p.puestoNombre}</p>
                <p class="text-sm text-slate-300 mt-1">Ver actividades → EPP / Riesgo / Impacto</p>
              </div>
              <span class="text-slate-300">›</span>
            </div>
          </div>
        </a>
      `;
    }

    function render(filtro = "") {
      const f = filtro.trim().toLowerCase();
      const data = puestosUnicos.filter(p => p.puestoNombre.toLowerCase().includes(f));
      lista.innerHTML = data.map(cardPuesto).join("") || `
        <div class="rounded-3xl border border-white/10 bg-white/5 p-5 text-slate-300">
          No se encontraron puestos con ese texto.
        </div>
      `;
    }

    buscador.addEventListener("input", (e) => render(e.target.value));
    render();
  </script>
</body>
</html>
